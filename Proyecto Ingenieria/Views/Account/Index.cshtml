@{
    Layout = null;
}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login y Registro</title>
    <link rel="stylesheet" href="~/AccountTemplate/css/styles.css">
</head>
<body>
    <div class="container">
        <div class="form-container">
            <div class="form-wrapper">
                <!-- Formulario de Login -->
                <form class="login-form" id="loginForm">
                    <h2>Iniciar Sesión</h2>
                    <div class="input-group">
                        <label for="login-email">Correo Electrónico</label>
                        <input type="email" id="login-email" placeholder="example@correo.com" required>
                    </div>
                    <div class="input-group">
                        <label for="login-password">Contraseña</label>
                        <input type="password" id="login-password" placeholder="••••••••" required>
                    </div>
                    <button type="submit" class="btn">Ingresar</button>
                    <p class="toggle-form">¿No tienes una cuenta? <a href="#" id="show-register">Regístrate</a></p>
                </form>

                <!-- Formulario de Registro -->
                <form class="register-form" id="registerForm" style="display: none;">
                    <h2>Regístrate</h2>
                    <div class="input-group">
                        <label for="register-email">Correo Electrónico</label>
                        <input type="email" id="register-email" placeholder="example@correo.com" required>
                    </div>
                    <div class="input-group">
                        <label for="register-password">Contraseña</label>
                        <input type="password" id="register-password" placeholder="••••••••" required>
                    </div>
                    <div class="input-group">
                        <label for="register-name">Nombre Completo</label>
                        <input type="text" id="register-name" placeholder="Tu nombre completo" required>
                    </div>
                    <div class="input-group">
                        <label for="register-cedula">Cédula</label>
                        <input type="text" id="register-cedula" placeholder="12345678" required>
                    </div>
                    <div class="input-group">
                        <label for="register-birthdate">Fecha de Nacimiento</label>
                        <input type="date" id="register-birthdate" required>
                    </div>
                    <div class="input-group">
                        <label for="register-phone">Teléfono</label>
                        <input type="text" id="register-phone" placeholder="Número de teléfono" required>
                    </div>
                    <div class="input-group">
                        <label for="register-address">Dirección</label>
                        <textarea id="register-address" placeholder="Tu dirección" required></textarea>
                    </div>
                    <button type="submit" class="btn">Registrar</button>
                    <p class="toggle-form">¿Ya tienes una cuenta? <a href="#" id="show-login">Iniciar Sesión</a></p>
                </form>


            </div>
        </div>
        <div class="side-panel">
            <h1>Bienvenido</h1>
            <p>Accede o crea una cuenta para disfrutar de nuestros servicios.</p>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        // Lógica para mostrar y ocultar formularios de login y registro
        $('#show-register').on('click', function () {
            $('.login-form').hide();
            $('.register-form').show();
        });

        $('#show-login').on('click', function () {
            $('.register-form').hide();
            $('.login-form').show();
        });

        $('#registerForm').on('submit', function (e) {
            e.preventDefault(); // Evitar el envío por defecto del formulario

            // Obtener los valores del formulario
            var username = $('#register-email').val();
            var password = $('#register-password').val();
            var name = $('#register-name').val();
            var cedula = $('#register-cedula').val();
            var birthDate = $('#register-birthdate').val();
            var phone = $('#register-phone').val();
            var address = $('#register-address').val();

            // Crear el objeto JSON
            var data = {
                "username": username,
                "password": password,
                "role": 'Cliente', // Fijo para registro de clientes
                "customer": {
                    "name": name,
                    "cedula": cedula,
                    "birthDate": birthDate,
                    "phone": phone,
                    "address": address
                }
            };

            $.ajax({
                url: 'https://localhost:7277/api/User',
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify(data),
                success: function (response) {
                    console.log('Usuario registrado con éxito:', response);
                    alert('Registro exitoso');
                    // Redirigir al login o dashboard
                    $('.register-form').hide();
                    $('.login-form').show();
                },
                error: function (xhr, status, error) {
                    console.error('Error al registrar:', error);
                    alert('Hubo un problema al registrar el usuario');
                }
            });
        });


        // Manejo del formulario de login con AJAX
        $('#loginForm').on('submit', function (e) {
            e.preventDefault(); // Evitar el envío por defecto del formulario

            // Obtener los valores del formulario
            var username = $('#login-email').val();
            var password = $('#login-password').val();

            // Crear el objeto JSON
            var data = {
                "username": username,
                "password": password,
                "role": 'Cliente'
            };

            $.ajax({
                url: 'https://localhost:7277/api/User/Login', // API para login
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify(data),
                success: function (response) {
                    console.log('Login exitoso:', response);
                    // Almacenar el token JWT en localStorage o sessionStorage
                    localStorage.setItem('token', response.token);
                    alert('Login exitoso');
                    // Redirigir a una página protegida o dashboard
                    window.location.href = '/User/Index';
                },
                error: function (xhr, status, error) {
                    console.error('Error al iniciar sesión:', error);
                    alert('Usuario o contraseña incorrectos');
                }
            });
        });

    </script>

    <script src="~/AccountTemplate/js/script.js"></script>
</body>
</html>

